<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, user-scalable=no">
		<link rel="stylesheet" type="text/css" href="style.css">	
		<title>UBT chassis</title>
	</head>
	<body>
		<ul class="navbar">
		   <li><a href="/">Home</a></li> 
		   <li><a href="/power.html">Power</a></li> 
		   <li><a class="active" href="/brake_and_sensor.html">刹车和传感器</a></li> 
		   <li><a href="/set.html">设置</a></li> 
		   <li><a href="/diagnosis.html">诊断</a></li> 
		   <li><a href="/odom_calibration.html">里程计标定</a></li> 
		   <li><a href="/upgrade.html">升级</a></li> 
		   <li><a href="/other.html">其它</a></li>
		</ul>

		<div class="grid main">

   <div style="background-color:#0066CC;color:#fff;margin-top:30px;  "> 
    <h2> <span>刹车</span> </h2> 
   </div> 
   <div align="center"> 
    <table border="1" cellpadding="10"> 
     <tbody>
      <tr> 
       <td style="background-color:#0066CC;color:#fff;margin-top:30px;  " width="50"><div align="center">急停</div> </td> 
	   <td style="background-color:#0066CC;color:#fff;margin-top:30px;  " width="50"><div align="center">防撞条</div> </td> 
       <td style="background-color:#0066CC;color:#fff;margin-top:30px;  " width="50"><div align="center">刹车</div> </td> 
	   <td style="background-color:#0066CC;color:#fff;margin-top:30px;  " width="200"><div align="center">刹车源</div> </td>
	   <td style="background-color:#0066CC;color:#fff;margin-top:30px;  " width="90"><div align="center">解锁</div> </td>
      </tr> 
     </tbody>
    </table> 
    <table border="1" cellpadding="10"> 
     <tbody>
      <tr> 
        <td width="50" id="upemergency_button"></td> 
        <td width="50" id="upbumper"></td> 
        <td width="50" id="upbrake"></td> 
        <td width="200" id="upbrake_source"></td> 
        <td width="90"> 
			<div align="center"> 
				<button onclick="micro('unLock');">解锁</button> 
			</div> 
		</td> 

      </tr> 
     </tbody>
    </table> 
   </div> 
 
   <div style="background-color:#0066CC;color:#fff;margin-top:30px;  "> 
    <h2> <span>传感器</span> </h2> 
   </div> 
   <div align="center"> 
    <table border="1" cellpadding="10"> 
     <tbody>
      <tr> 
       <td style="background-color:#0066CC;color:#fff;margin-top:30px;  " width="70"><div align="center">温度1</div> </td> 
	   <td style="background-color:#0066CC;color:#fff;margin-top:30px;  " width="70"><div align="center">温度2</div> </td> 
       <td style="background-color:#0066CC;color:#fff;margin-top:30px;  " width="70"><div align="center">温度3</div> </td> 
	   <td style="background-color:#0066CC;color:#fff;margin-top:30px;  " width="70"><div align="center">温度4</div> </td>
	   <td style="background-color:#0066CC;color:#fff;margin-top:30px;  " width="70"><div align="center">湿度</div> </td>
      </tr> 
     </tbody>
    </table> 
    <table border="1" cellpadding="10"> 
     <tbody>
      <tr> 
        <td width="70" id="uptemperture1"></td> 
        <td width="70" id="uptemperture2"></td> 
        <td width="70" id="uptemperture3"></td> 
        <td width="70" id="uptemperture4"></td> 
        <td width="70" id="uphumidity"></td> 
      </tr> 
     </tbody>
    </table> 
   </div> 
 
   <div style="background-color:#0066CC;color:#fff;margin-top:30px;  "> 
    <h2> <span>电池信息</span> </h2> 
   </div> 
   <div align="center"> 
    <table border="1" cellpadding="10"> 
     <tbody>
      <tr> 
       <td style="background-color:#0066CC;color:#fff;margin-top:30px;  " width="50"><div align="center">电池组</div> </td> 
       <td style="background-color:#0066CC;color:#fff;margin-top:30px;  " width="50"><div align="center">电压1</div> </td> 
	   <td style="background-color:#0066CC;color:#fff;margin-top:30px;  " width="50"><div align="center">电压2</div> </td> 
       <td style="background-color:#0066CC;color:#fff;margin-top:30px;  " width="50"><div align="center">电压3</div> </td> 
	   <td style="background-color:#0066CC;color:#fff;margin-top:30px;  " width="50"><div align="center">电压4</div> </td>
	   <td style="background-color:#0066CC;color:#fff;margin-top:30px;  " width="50"><div align="center">电压5</div> </td>
	   <td style="background-color:#0066CC;color:#fff;margin-top:30px;  " width="50"><div align="center">电压6</div> </td>
	   <td style="background-color:#0066CC;color:#fff;margin-top:30px;  " width="50"><div align="center">电压7</div> </td>
	   <td style="background-color:#0066CC;color:#fff;margin-top:30px;  " width="50"><div align="center">电压8</div> </td>
	   <td style="background-color:#0066CC;color:#fff;margin-top:30px;  " width="50"><div align="center">总电压</div> </td>
	   <td style="background-color:#0066CC;color:#fff;margin-top:30px;  " width="50"><div align="center">电流</div> </td>
      </tr> 
     </tbody>
    </table> 
	
    <table border="1" cellpadding="10"> 
     <tbody>
      <tr> 
        <td width="50"  align="center">主</td> 
        <td width="50" id="upg1voltage1"></td> 
        <td width="50" id="upg1voltage2"></td> 
        <td width="50" id="upg1voltage3"></td> 
        <td width="50" id="upg1voltage4"></td> 
        <td width="50" id="upg1voltage5"></td> 
        <td width="50" id="upg1voltage6"></td> 
        <td width="50" id="upg1voltage7"></td> 
        <td width="50" id="upg1voltage8"></td> 
        <th width="50" rowspan="2" id="upvoltage_toltal"></th> 
        <th width="50" rowspan="2" id="upcurrent"></th> 
      </tr> 
	  <tr> 
        <td width="50"  align="center">从</td> 
        <td width="50" id="upg2voltage1"></td> 
        <td width="50" id="upg2voltage2"></td> 
        <td width="50" id="upg2voltage3"></td> 
        <td width="50" id="upg2voltage4"></td> 
        <td width="50" id="upg2voltage5"></td> 
        <td width="50" id="upg2voltage6"></td> 
        <td width="50" id="upg2voltage7"></td> 
        <td width="50" id="upg2voltage8"></td> 
      </tr> 
     </tbody>
    </table> 
   </div> 
   
   <div style="background-color:#0066CC;color:#fff;margin-top:30px;  "> 
    <h2> <span>电源显示屏自测</span> </h2> 
   </div> 
   <div align="center"> 
		<button onclick="micro('screenTest');">自测</button> 
   </div> 
 
   <div style="background-color:#0066CC;color:#fff;margin-top:30px;  "> 
    <h2> <span>摇控器数据</span> </h2> 
   </div> 
   <div align="center"> 
    <table border="1" cellpadding="10"> 
     <tbody>
      <tr> 
       <td style="background-color:#0066CC;color:#fff;margin-top:30px;  " width="40"><div align="center">ch1</div> </td> 
       <td style="background-color:#0066CC;color:#fff;margin-top:30px;  " width="40"><div align="center">ch2</div> </td> 
       <td style="background-color:#0066CC;color:#fff;margin-top:30px;  " width="40"><div align="center">ch3</div> </td> 
       <td style="background-color:#0066CC;color:#fff;margin-top:30px;  " width="40"><div align="center">ch4</div> </td> 
       <td style="background-color:#0066CC;color:#fff;margin-top:30px;  " width="40"><div align="center">ch5</div> </td> 
       <td style="background-color:#0066CC;color:#fff;margin-top:30px;  " width="40"><div align="center">ch6</div> </td> 
       <td style="background-color:#0066CC;color:#fff;margin-top:30px;  " width="40"><div align="center">ch7</div> </td> 
       <td style="background-color:#0066CC;color:#fff;margin-top:30px;  " width="40"><div align="center">ch8</div> </td> 
       <td style="background-color:#0066CC;color:#fff;margin-top:30px;  " width="40"><div align="center">ch9</div> </td> 
       <td style="background-color:#0066CC;color:#fff;margin-top:30px;  " width="40"><div align="center">ch10</div> </td> 
       <td style="background-color:#0066CC;color:#fff;margin-top:30px;  " width="40"><div align="center">ch11</div> </td> 
       <td style="background-color:#0066CC;color:#fff;margin-top:30px;  " width="40"><div align="center">ch12</div> </td> 
       <td style="background-color:#0066CC;color:#fff;margin-top:30px;  " width="40"><div align="center">ch13</div> </td> 
       <td style="background-color:#0066CC;color:#fff;margin-top:30px;  " width="40"><div align="center">ch14</div> </td> 
       <td style="background-color:#0066CC;color:#fff;margin-top:30px;  " width="40"><div align="center">ch15</div> </td> 
       <td style="background-color:#0066CC;color:#fff;margin-top:30px;  " width="40"><div align="center">ch16</div> </td> 
	   <td style="background-color:#0066CC;color:#fff;margin-top:30px;  " width="40"><div align="center">flag</div> </td>
      </tr> 
     </tbody>
    </table> 
    <table border="1" cellpadding="10"> 
     <tbody>
      <tr> 
        <td width="40" id="uprem_ch1"></td> 
        <td width="40" id="uprem_ch2"></td> 
        <td width="40" id="uprem_ch3"></td> 
        <td width="40" id="uprem_ch4"></td> 
        <td width="40" id="uprem_ch5"></td> 
        <td width="40" id="uprem_ch6"></td> 
        <td width="40" id="uprem_ch7"></td> 
        <td width="40" id="uprem_ch8"></td> 
        <td width="40" id="uprem_ch9"></td> 
        <td width="40" id="uprem_ch10"></td> 
        <td width="40" id="uprem_ch11"></td> 
        <td width="40" id="uprem_ch12"></td> 
        <td width="40" id="uprem_ch13"></td> 
        <td width="40" id="uprem_ch14"></td> 
        <td width="40" id="uprem_ch15"></td> 
        <td width="40" id="uprem_ch16"></td> 
        <td width="40" id="uprem_flag"></td> 
      </tr> 
     </tbody>
    </table> 
   </div> 
 
 
  <script type="text/javascript"></script> 
  <script>
			var ws;
			var retries;
			var set = false;
			var error_code = [
					"normal",
					"编码器ABZ报警",
					"编码器UVW报警",
					"位置超差",
					"失速",
					"ADC零点异常",
					"过载",
					"功率电源欠压",
					"功率电源过压",
					"过流",
					"瞬时放电报警",
					"平均放电报警",
					"参数读写异常",
					"输入端口重复定义",
					"断线保护",
					"温度报警"
					];
			
			window.onload = function() {
				console.log('wsOpen()');
				wsOpen();
				
			}		


			function setMsg(cls, text) {
					console.log(cls + text);

					
			}//
			function replaceAll(str)  
			{  
				while(str.indexOf("^")!=-1){
					str = str.replace("^","°");
				}
				return str;  
			} 
			function deal(evt) {
					var stats = JSON.parse(evt.data);
					console.log(stats);
					for(var k in stats) {
					    if( k == 'name')
							continue;
						if(set){
							set = false;
							continue;
							}							
						if( k == 'upremote'){
							var arr = stats[k].split(',');							
							document.getElementById('uprem_ch1').innerHTML =  arr[0];
							document.getElementById('uprem_ch2').innerHTML =  arr[1];
							document.getElementById('uprem_ch3').innerHTML =  arr[2];
							document.getElementById('uprem_ch4').innerHTML =  arr[3];
							document.getElementById('uprem_ch5').innerHTML =  arr[4];
							document.getElementById('uprem_ch6').innerHTML =  arr[5];
							document.getElementById('uprem_ch7').innerHTML =  arr[6];
							document.getElementById('uprem_ch8').innerHTML =  arr[7];
							document.getElementById('uprem_ch9').innerHTML =  arr[8];
							document.getElementById('uprem_ch10').innerHTML =  arr[9];
							document.getElementById('uprem_ch11').innerHTML =  arr[10];
							document.getElementById('uprem_ch12').innerHTML =  arr[11];
							document.getElementById('uprem_ch13').innerHTML =  arr[12];
							document.getElementById('uprem_ch14').innerHTML =  arr[13];
							document.getElementById('uprem_ch15').innerHTML =  arr[14];
							document.getElementById('uprem_ch16').innerHTML =  arr[15];
							document.getElementById('uprem_flag').innerHTML =  arr[16];
							continue;
						}						

						
						document.getElementById(k).innerHTML =  stats[k];
					}

					
			}

			function wsOpen() {
				if (ws === undefined || ws.readyState != 0) {
					if (retries)
						setMsg("error", "WebSocket timeout, retrying..");
					else
						setMsg("info", "Opening WebSocket..");
						var uri = "/bra"
					ws = new WebSocket("ws://" + location.host + uri);

					ws.onopen = function(evt) { retries = 0; setMsg("done", "WebSocket is open."); };
					ws.onerror = function(evt) { setMsg("error", "WebSocket error!"); };
					ws.onmessage = function(evt) { deal(evt);	};

					retries = 0;
				}
			}
			function wsWrite(data) {
				if (ws.readyState == 3 || retries++ > 5)
					wsOpen();
				else if (ws.readyState == 1)
					ws.send('bra:' + data);
			}
			function caliChassis(){
				
				document.getElementById('calibration').disabled = true;
				wsWrite('steer');
			}
			
			function micro(sw){
				set = true;
				if (document.getElementById(sw).checked)
					wsWrite(sw + '-e');
				else
					wsWrite(sw + '-d');
			}

		</script>   
 </body>

</html>
