# **导航通用接口消息协议**

## **版本变更记录**
			
| 版本号 |                            作者                            |         时间          |          修改内容          |
|:------:|:----------------------------------------------------------:|:---------------------:|:--------------------------:|
|        | 付品军、黄启定、张木森、聂鹏、何哲、焦小亮、弓建仁、陈帅飞 | 2020.2.10 ~ 2020.2.11 |        确定协议方案        |
|  v0.1  |                       弓建仁、陈帅飞                       | 2020.2.10 ~ 2020.2.11 |          创建初稿          |
|  v0.2  |                       付品军、陈帅飞                       |       2020.2.12       |   增加标识命令的UUID字段    |
|  v0.3  |                弓建仁、何哲、焦小亮、陈帅飞                 |       2020.2.12       | 修改设置速度和查看速度协议   |
|  v0.4  |                弓建仁、聂鹏、何哲、焦小亮、陈帅飞           |       2020.2.13~2020.2.14 | 1. 传感器数据格式统一参考ros           sensor_msgs  2. 确定传感器数据和控制数据通信方案  3. 修正部分接口格式 4. 增加编辑地图相关接口 5.增加录制路径相关接口 6.增加并分类部分状态码|
|  v0.5  |                陈帅飞           |  2020.2.15 | 增加上传地图和下载地图接口|
|  v0.6  |         弓建仁、陈帅飞           |  2020.3.5  | 增加导航行为策略配置接口|

---


<!-- TOC -->

- [**导航通用接口消息协议**](#导航通用接口消息协议)
  - [**版本变更记录**](#版本变更记录)
  - [**接口说明和规范**](#接口说明和规范)
  - [**建图(mapping)**](#建图mapping)
    - [开始建图](#开始建图)
    - [暂停建图](#暂停建图)
    - [恢复建图](#恢复建图)
    - [结束建图](#结束建图)
    - [获取建图任务状态](#获取建图任务状态)
    - [获取地图列表](#获取地图列表)
    - [地图格式标准](#地图格式标准)
    - [上传地图](#上传地图)
    - [下载地图](#下载地图)
    - [使用地图](#使用地图)
    - [取消使用地图](#取消使用地图)
    - [重命名地图](#重命名地图)
    - [删除地图](#删除地图)
    - [删除全部地图](#删除全部地图)
    - [点相关](#点相关)
      - [添加点](#添加点)
      - [获取点](#获取点)
      - [删除点](#删除点)
      - [重命名点](#重命名点)
    - [线相关](#线相关)
      - [添加线](#添加线)
      - [获取线](#获取线)
      - [删除线](#删除线)
      - [重命名线](#重命名线)
    - [录制路径](#录制路径)
      - [开始录制路径](#开始录制路径)
      - [暂停录制路径](#暂停录制路径)
      - [恢复录制路径](#恢复录制路径)
      - [结束录制路径](#结束录制路径)
      - [获取录制路径任务状态](#获取录制路径任务状态)
  - [**定位(locating)**](#定位locating)
    - [开始定位](#开始定位)
    - [暂停定位](#暂停定位)
    - [恢复定位](#恢复定位)
    - [结束定位](#结束定位)
    - [获取定位任务状态](#获取定位任务状态)
    - [获取定位结果](#获取定位结果)
    - [获取机器人实时位置](#获取机器人实时位置)
  - [**导航(navigating)**](#导航navigating)
    - [开始导航](#开始导航)
    - [暂停导航](#暂停导航)
    - [恢复导航](#恢复导航)
    - [结束导航](#结束导航)
    - [获取导航任务状态](#获取导航任务状态)
    - [导航状态主动推送](#导航状态主动推送)
    - [设置速度](#设置速度)
    - [查看当前速度](#查看当前速度)
    - [导航行为策略配置](#导航行为策略配置)
      - [设置安全距离](#设置安全距离)
      - [获取安全距离](#获取安全距离)
      - [设置反应距离](#设置反应距离)
      - [获取反应距离](#获取反应距离)
      - [停障绕障开关命令](#停障绕障开关命令)
      - [获取停障绕障开关状态](#获取停障绕障开关状态)
      - [设置避障半径](#设置避障半径)
      - [获取避障半径](#获取避障半径)
      - [允许后退开关命令](#允许后退开关命令)
      - [获取允许后退开关状态](#获取允许后退开关状态)
      - [不同传感器数据在避障行为响应所占权重可配置](#不同传感器数据在避障行为响应所占权重可配置)
      - [智能识别避障](#智能识别避障)
  - [**传感器数据输出** [ubt -> 供应商]](#传感器数据输出-ubt---供应商)
    - [超声波(ultrasound)](#超声波ultrasound)
    - [里程计(odometry)](#里程计odometry)
    - [IMU](#imu)
    - [GPS](#gps)
    - [摄像头(Camera)](#摄像头camera)
    - [激光雷达(Lidar)](#激光雷达lidar)
  - [**底盘控制数据（线速度、角速度）输出**   [供应商 -> ubt]](#底盘控制数据线速度角速度输出---供应商---ubt)
  - [**附录**](#附录)
    - [状态码/错误码](#状态码错误码)

<!-- /TOC -->

---


## **接口说明和规范**

请求命令title字段：前缀为request_，后面是具体命令名；

回复命令title字段：前缀为response_，后面是具体命令名；

主动通知命令title字段：前缀为notify_, 后面是具体命令名；

命令内容包含在content字段;

完整的协议是序列化后合法的json字符串。

- 请求命令示意：

    ```javascript
    {
        "title":"request_xxx ",
        "content": {
            "id": string, // 标识命令的UUID
            "timestamp": long  // 标识命令发起的时戳，单位毫秒，数据类型为long
            "data": string //
     	}
    }
    ```
    
 - 回复命令示意：  

    ```javascript
    {
        "title": "response_xxx ",
        "content": {
            "id": string, // 同步命令此id与请求命令id一致
            "timestamp": long, // 同步命令与请求命令的时戳保持一致
            "data":string,  // 数据
            "msg":string, //状态和错误信息描述
            "code": int,  //状态码和错误码
            "result": string // [success, failure]
     	}
    }
    ```


- 主动通知示意：

    ```javascript
    {
        "title": "notify_xxx ",
        "content": {
            "id": string, // 标识命令的UUID
            "timestamp": long,  // 同步命令与请求命令的时戳保持一致
            "data":string,  // 数据
            "msg": string, // 状态和错误信息描述
            "code": int,  // 状态码和错误码
            "result": string // [success, failure]
    }
    ```

---


## **建图(mapping)**

### 开始建图
- 请求开始建图：

    ```javascript
    {
        "title":"request_start_mapping",
        "content": {
            "id": string,
            "timestamp": long  // 标识命令发起的时戳，单位毫秒，数据类型为long
            "data": string,      // 要建的地图名称
        }
    }
    ```

- 回复开始建图：  

    ```javascript
    {
        "title": "response_start_mapping",
        "content": {
            "id": string,
            "timestamp": long,  // 同步命令与请求命令的时戳保持一致
            "msg": string,
            "code":int,
            "result": string  // [success, failure]
        }
    }
    ```
### 暂停建图
- 请求暂停建图：
    ```javascript
    {
        "title":"request_pause_mapping",
        "content": {
            "id": string, 
            "timestamp": long  // 标识命令发起的时戳，单位毫秒，数据类型为long
        }
    }
    ```

- 回复暂停建图：  

    ```javascript
    {
        "title": "response_pause_mapping",
        "content": {
            "id": string, 
            "timestamp": long,  // 同步命令与请求命令的时戳保持一致
            "msg": string,
            "code":int,
            "result": string  // [success, failure]
        }
    }
    ```
### 恢复建图
- 请求恢复建图：
    ```javascript
    {
        "title":"request_resume_mapping",
        "content": {
            "id": string,
            "timestamp": long  // 标识命令发起的时戳，单位毫秒，数据类型为long
        }
    }
    ```

- 回复恢复建图：  

    ```javascript
    {
        "title": "response_resume_mapping",
        "content": {
            "id": string,
            "timestamp": long,  // 同步命令与请求命令的时戳保持一致
            "msg": string,
            "code": int,
            "result": string  // [success, failure]
        }
    }
    ```

### 结束建图
- 请求结束建图：

    ```javascript
    {
        "title":"request_stop_mapping",
        "content": {
            "id": string,
            "timestamp": long  // 标识命令发起的时戳，单位毫秒，数据类型为long
        }
    }
    ```

- 回复结束建图：  

    ```javascript
    {
        "title": "response_stop_mapping",
        "content": {
            "id": string,
            "timestamp": long,  // 同步命令与请求命令的时戳保持一致
            "msg": string,
            "code": int,
            "result": string  // [success, failure]
        }
    }
    ```
### 获取建图任务状态
- 请求获取建图任务状态：

    ```javascript
    {
        "title":"request_get_mapping_status",
        "content": {
            "id": string,
            "timestamp": long  // 标识命令发起的时戳，单位毫秒，数据类型为long
        }
    }
    ```

- 回复获取建图任务状态：  

    ```javascript
    {
        "title": "response_get_mapping_status",
        "content": {
            "id": string,
            "timestamp": long,  // 同步命令与请求命令的时戳保持一致
            "msg": string,
            "code": int,
            "result": string  // [success, failure]
        }
    }
    ```
### 获取地图列表
- 请求获取地图列表：

    ```javascript
    {
        "title":"request_get_map_list",
        "content": {
            "id": string,
            "timestamp": long  // 标识命令发起的时戳，单位毫秒，数据类型为long
        }
    }
    ```

- 回复获取地图列表：  

    ```javascript
    {
        "title": "response_get_map_list",
        "content": {
            "id": string,
            "timestamp": long,  // 同步命令与请求命令的时戳保持一致
            "data": [
                {
                    "mapname": string //
                },
                {
                    "mapname": string //
                },
                ...
            ],
            "msg": string,
            "code": int,
            "result": string  // [success, failure]
        }
    }
    ```
### 地图格式标准
todo    
### 上传地图
- 请求上传地图： 
    ```javascript
    {
        "title":"request_upload_map",
        "content": {
            "id": string,
            "timestamp": long  // 标识命令发起的时戳，单位毫秒，数据类型为long
            "data": string,      // 地图名称
        }
    }
    ```

- 回复上传地图:

    ```javascript
    {
        "title": "response_upload_map",
        "content": {
            "id": string,
            "timestamp": long,  // 同步命令与请求命令的时戳保持一致
            "msg": string,
            "code": int,
            "result": string  // [success, failure]
        }
    }
    ```

### 下载地图

- 请求下载地图： 
    ```javascript
    {
        "title":"request_download_map",
        "content": {
            "id": string,
            "timestamp": long  // 标识命令发起的时戳，单位毫秒，数据类型为long
            "data": string,      // 地图名称
        }
    }
    ```

- 回复下载地图：  

    ```javascript
    {
        "title": "response_download_map",
        "content": {
            "id": string,
            "timestamp": long,  // 同步命令与请求命令的时戳保持一致
            "msg": string,
            "code": int,
            "result": string  // [success, failure]
        }
    }
    ```

### 使用地图
- 请求使用地图：

    ```javascript
    {
        "title":"request_set_map",
        "content": {
            "id": string,
            "timestamp": long  // 标识命令发起的时戳，单位毫秒，数据类型为long
            "data": string,      // 地图名称
        }
    }
    ```

- 回复使用地图：  

    ```javascript
    {
        "title": "response_set_map",
        "content": {
            "id": string,
            "timestamp": long,  // 同步命令与请求命令的时戳保持一致
            "msg": string,
            "code": int,
            "result": string  // [success, failure]
        }
    }
    ```
### 取消使用地图
- 请求取消使用地图：

    ```javascript
    {
        "title":"request_cancel_map",
        "content": {
            "id": string,
            "timestamp": long,  // 标识命令发起的时戳，单位毫秒，数据类型为long
            "data": string,      // 地图名称
        }
    }
    ```

- 回复取消使用地图：  

    ```javascript
    {
        "title": "response_cancel_map",
        "content": {
            "id": string,
            "timestamp": long,  // 同步命令与请求命令的时戳保持一致
            "msg": string,
            "code": int,
            "result": string  // [success, failure]
        }
    }
### 重命名地图
- 请求重命名地图：

    ```javascript
    {
        "title":"request_rename_map",
        "content": {
            "id": string,
            "timestamp": long  // 标识命令发起的时戳，单位毫秒，数据类型为long
            "origin_name": string,      // 原来地图名称
            "new_name": string    //新地图名称
        }
    }
    ```

- 回复重命名地图：  

    ```javascript
    {
        "title": "response_rename_map",
        "content": {
            "id": string,
            "timestamp": long,  // 同步命令与请求命令的时戳保持一致
            "msg": string,
            "code": int,
            "result": string  // [success, failure]
        }
    }
    ```
### 删除地图
- 请求删除地图：

    ```javascript
    {
        "title":"request_del_map",
        "content": {
            "id": string,
            "timestamp": long  // 标识命令发起的时戳，单位毫秒，数据类型为long
            "data": string,      // 要删除的地图名称
        }
    }
    ```

- 回复删除地图：  

    ```javascript
    {
        "title": "response_del_map",
        "content": {
            "id": string,
            "timestamp": long,  // 同步命令与请求命令的时戳保持一致
            "msg": string,
            "code": int,
            "result": string  // [success, failure]
        }
    }
    ```
### 删除全部地图
- 请求删除全部地图：

    ```javascript
    {
        "title":"request_del_all_map",
        "content": {
            "id": string,
            "timestamp": long  // 标识命令发起的时戳，单位毫秒，数据类型为long
        }
    }
    ```

- 回复删除全部地图：  

    ```javascript
    {
        "title": "response_del_all_map",
        "content": {
            "id": string,
            "timestamp": long,  // 同步命令与请求命令的时戳保持一致
            "msg": string,
            "code": int,
            "result": string  // [success, failure]
        }
    }
    ```


### 点相关

#### 添加点

- 请求添加点

    ```javascript
    {
        "title":"request_add_point",
        "content": {
            "id": string,
            "timestamp": long,  // 标识命令发起的时戳，单位毫秒，数据类型为long
            "data": {
                "mapName": string,
                "pointname": string,
                "orientation": {
                    "roll": float,
                    "pitch": float,
                    "yaw": float
                },
                "position": {
                    "x": float,
                    "y": float,
                    "z": float
                }
            }
        }
    }
    ```

- 回复添加点

    ```javascript
    {
        "title": "response_add_point",
        "content": {
            "id": string,
            "timestamp": long,  // 同步命令与请求命令的时戳保持一致
            "msg": string,
            "code": int,
            "result": string  // [success, failure]
        }
    }
    ```

#### 获取点
- 请求获取点

    ```javascript
    {
        "title":"request_get_point_list",
        "content": {
            "id": string,
            "timestamp": long  // 标识命令发起的时戳，单位毫秒，数据类型为long
            "mapname": string,
        }
    }
    ```

- 回复获取点

    ```javascript
    {
        "title": "response_get_point_list",
        "content": {
            "id": string,
            "timestamp": long,  // 同步命令与请求命令的时戳保持一致
            "data": [
                    {
                        "pointname": string,
                        "orientation": {
                            "roll": float,
                            "pitch": float,
                            "yaw": float
                        },
                        "position": {
                            "x": float,
                            "y": float,
                            "z": float
                        }
                    },

                    {
                        "pointname": string,
                        "orientation": {
                            "roll": float,
                            "pitch": float,
                            "yaw": float
                        },
                        "position": {
                            "x": float,
                            "y": float,
                            "z": float
                        }
                    }
                .....
            ]
            "msg": string,
            "code": int,
            "result": string  // [success, failure]
        }
    }
    ```

#### 删除点

- 请求删除点

    ```javascript
    {
        "title": "request_del_point",
        "content": {
            "id": string,
            "timestamp": long,  // 同步命令与请求命令的时戳保持一致
            "mapname": string, // 要删除点所在的地图
            "pointname": string, // 要删除点名称
        }
    }
    ```

- 回复删除点

    ```javascript
    {
        "title": "response_del_point",
        "content": {
            "id": string,
            "timestamp": long,  // 同步命令与请求命令的时戳保持一致
            "msg": string,
            "code": int,
            "result": string  // [success, failure]
        }
    }
    ```

#### 重命名点

- 请求重命名点

    ```javascript
    {
        "title": "request_rename_point",
        "content": {
            "id": string,
            "timestamp": long,  // 同步命令与请求命令的时戳保持一致
            "mapname": string, // 点所在的地图
            "orig in_name": string, // 点原来的名称
            "new_name": string, // 点的新名称
        }
    }
    ```
- 回复重命名点

    ```javascript
    {
        "title": "response_rename_point",
        "content": {
            "id": string,
            "timestamp": long,  // 同步命令与请求命令的时戳保持一致
            "msg": string,
            "code": int,
            "result": string  // [success, failure]
        }
    }
    ```

### 线相关

#### 添加线

- 请求添加线

    ```javascript
    {
        "title": "request_add_line",
        "content": {
            "id": string,
            "timestamp": long,  // 同步命令与请求命令的时戳保持一致
            "mapname": string, // 要添加的线所在的地图
            "pointname": string, // 要添加的线的名称
            "points": [  // 传入两个点
                {
                    "pointname": string,
                    "orientation": {
                        "roll": float,
                        "pitch": float,
                        "yaw": float
                    },
                    "position": {
                        "x": float,
                        "y": float,
                        "z": float
                    }
                },
                {
                    "pointname": string,
                    "orientation": {
                        "roll": float,
                        "pitch": float,
                        "yaw": float
                    },
                    "position": {
                        "x": float,
                        "y": float,
                        "z": float
                    }
                }
            ]
        }
    }
    ```

- 回复添加线

    ```javascript
    {
        "title": "response_add_line",
        "content": {
            "id": string,
            "timestamp": long,  // 同步命令与请求命令的时戳保持一致
            "msg": string,
            "code": int,
            "result": string  // [success, failure]
        }
    }
    ```


#### 获取线

- 请求获取线

    ```javascript
    {
        "title": "request_get_line",
        "content": {
            "id": string,
            "timestamp": long,  // 同步命令与请求命令的时戳保持一致
            "mapname": string,
        }
    }
    ```

- 回复获取线

    ```javascript
    {
        "title": "response_get_line",
        "content": {
            "id": string,
            "timestamp": long,  // 同步命令与请求命令的时戳保持一致
            "lines"：[
                {
                    "line_name": string,
                    "points": [  // 两个点
                        {
                            "pointname": string,
                            "orientation": {
                                "roll": float,
                                "pitch": float,
                                "yaw": float
                            },
                            "position": {
                                "x": float,
                                "y": float,
                                "z": float
                            }
                        },
                        {
                            "pointname": string,
                            "orientation": {
                                "roll": float,
                                "pitch": float,
                                "yaw": float
                            },
                            "position": {
                                "x": float,
                                "y": float,
                                "z": float
                            }
                        }
                    ]
                },
                {
                    "line_name": string,
                    "points": [  // 传入两个点
                        {
                            "pointname": string,
                            "orientation": {
                                "roll": float,
                                "pitch": float,
                                "yaw": float
                            },
                            "position": {
                                "x": float,
                                "y": float,
                                "z": float
                            }
                        },
                        {
                            "pointname": string,
                            "orientation": {
                                "roll": float,
                                "pitch": float,
                                "yaw": float
                            },
                            "position": {
                                "x": float,
                                "y": float,
                                "z": float
                            }
                        }
                    ]
                },
                ....
            ]
            "msg": string,
            "code": int,
            "result": string  // [success, failure]
        }
    }
    ```

#### 删除线
- 请求删除线

    ```javascript
    {
        "title": "request_del_line",
        "content": {
            "id": string,
            "timestamp": long,  // 同步命令与请求命令的时戳保持一致
            "mapname": string, // 要删除的线所在的地图
            "linename": string, // 要删除线的名称
        }
    }
    ```

- 回复删除线

    ```javascript
    {
        "title": "response_del_line",
        "content": {
            "id": string,
            "timestamp": long,  // 同步命令与请求命令的时戳保持一致
            "msg": string,
            "code": int,
            "result": string  // [success, failure]
        }
    }
    ```

#### 重命名线

- 重命名线

    ```javascript
    {
        "title": "request_rename_line",
        "content": {
            "id": string,
            "timestamp": long,  // 同步命令与请求命令的时戳保持一致
            "mapname": string, // 要重命名线所在的地图
            "orgin_name": string, // 原来的线名称
            "new_name": string, // 新的线名称
            "result": string  // [success, failure]
        }
    }
    ```

- 回复删除线

    ```javascript
    {
        "title": "response_del_line",
        "content": {
            "id": string,
            "timestamp": long,  // 同步命令与请求命令的时戳保持一致
            "msg": string,
            "code": int,
            "result": string  // [success, failure]
        }
    }
    ```

---

###  录制路径

#### 开始录制路径

- 请求开始录制路径：

    ```javascript
    {
        "title":"request_start_recording_path",
        "content": {
            "id": string,
            "timestamp": long  // 标识命令发起的时戳，单位毫秒，数据类型为long
            "mapname": string, // 录制路径所在地图
            "path_name": string,      // 要录制的路径名
        }
    }
    ```

- 回复开始录制路径：  

    ```javascript
    {
        "title": "response_start_recording_path",
        "content": {
            "id": string,
            "timestamp": long,  // 同步命令与请求命令的时戳保持一致
            "msg": string,
            "code":int,
            "result": string  // [success, failure]
        }
    }
    ```

####  暂停录制路径

- 请求暂停录制路径

    ```javascript
    {
        "title":"request_pause_recording_path",
        "content": {
            "id": string,
            "timestamp": long  // 标识命令发起的时戳，单位毫秒，数据类型为long
        }
    }
    ```

- 回复暂停录制路径：  

    ```javascript
    {
        "title": "response_pause_recording_path",
        "content": {
            "id": string,
            "timestamp": long,  // 同步命令与请求命令的时戳保持一致
            "msg": string,
            "code":int,
            "result": string  // [success, failure]
        }
    }
    ```

####  恢复录制路径

- 请求暂停录制路径

    ```javascript
    {
        "title":"request_resume_recording_path",
        "content": {
            "id": string,
            "timestamp": long  // 标识命令发起的时戳，单位毫秒，数据类型为long
        }
    }
    ```

- 回复恢复录制路径：  

    ```javascript
    {
        "title": "response_resume_recording_path",
        "content": {
            "id": string,
            "timestamp": long,  // 同步命令与请求命令的时戳保持一致
            "msg": string,
            "code":int,
            "result": string  // [success, failure]
        }
    }
    ```

####  结束录制路径

- 请求结束录制路径

    ```javascript
    {
        "title":"request_stop_recording_path",
        "content": {
            "id": string,
            "timestamp": long  // 标识命令发起的时戳，单位毫秒，数据类型为long
        }
    }
    ```

- 回复结束录制路径：  

    ```javascript
    {
        "title": "response_stop_recording_path",
        "content": {
            "id": string,
            "timestamp": long,  // 同步命令与请求命令的时戳保持一致
            "msg": string,
            "code":int,
            "result": string  // [success, failure]
        }
    }
    ```

####  获取录制路径任务状态

- 请求结束录制路径

    ```javascript
    {
        "title":"request_get_recording_path_status",
        "content": {
            "id": string,
            "timestamp": long  // 标识命令发起的时戳，单位毫秒，数据类型为long
        }
    }
    ```

- 回复结束录制路径：  

    ```javascript
    {
        "title": "response_get_recording_path_status",
        "content": {
            "id": string,
            "timestamp": long,  // 同步命令与请求命令的时戳保持一致
            "msg": string,
            "code":int,
            "result": string  // [success, failure]
        }
    }
    ```

## **定位(locating)**

### 开始定位

- 请求开始定位：

    ```javascript
    {
        "title":"request_start_locating", 
        "content": {
            "id": string,
            "timestamp": long  // 标识命令发起的时戳，单位毫秒，数据类型为long
            "data": {
                "mode": int, // 0 不转圈，1 转圈
                "map_name": string,
                "frame_id": string,
                "orientation": {
                    "roll": float,
                    "pitch": float,
                    "yaw": float
                },
                "position": {
                    "x":float，
                    "y":float,
                    "z":float
                }

            }
        }
    }
    ```
        
- 回复开始定位：  

    ```javascript
    {
        "title": "response_start_locating",
        "content": {
            "id": string,
            "timestamp": long,  // 同步命令与请求命令的时戳保持一致
            "msg": string,
            "code":int,
            "result": string  // [success, failure]
        }
    }
    ```
### 暂停定位
- 请求暂停定位：
    ```javascript
    {
        "title":"request_pause_locating",
        "content": {
            "id": string,
            "timestamp": long, // 标识命令发起的时戳，单位毫秒，数据类型为long
        }
    }
    ```

- 回复暂停定位：  

    ```javascript
    {
        "title": "response_pause_locating",
        "content": {
            "id": string,
            "timestamp": long,  // 同步命令与请求命令的时戳保持一致
            "msg": string,
            "code":int,
            "result": string  // [success, failure]
        }
    }
    ```

### 恢复定位
- 请求恢复定位：
    ```javascript
    {
        "title":"request_resume_locating",
        "content": {
            "id": string,
            "timestamp": long  // 标识命令发起的时戳，单位毫秒，数据类型为long
        }
    }
    ```

- 回复恢复定位：  

    ```javascript
    {
        "title": "response_resume_locating",
        "content": {
            "id": string,
            "timestamp": long,  // 同步命令与请求命令的时戳保持一致
            "msg": string,
            "code": int,
            "result": string  // [success, failure]
        }
    }
    ```

### 结束定位
- 请求结束定位：
    ```javascript
    {
        "title":"request_stop_locating",
        "content": {
            "id": string,
            "timestamp": long  // 标识命令发起的时戳，单位毫秒，数据类型为long
        }
    }
    ```

- 回复结束定位：  

    ```javascript
    {
        "title": "response_stop_locating",
        "content": {
            "id": string,
            "timestamp": long,  // 同步命令与请求命令的时戳保持一致
            "msg": string,
            "code": int,
            "result": string  // [success, failure]
        }
    }
    ```
### 获取定位任务状态
- 请求获取定位任务状态：

    ```javascript
    {
        "title":"request_get_locating_status",
        "content": {
            "id": string,
            "timestamp": long  // 标识命令发起的时戳，单位毫秒，数据类型为long
        }
    }
    ```

- 回复获取定位任务状态：  

    ```javascript
    {
        "title": "response_get_locating_status",
        "content": {
            "id": string,
            "timestamp": long,  // 同步命令与请求命令的时戳保持一致
            "msg": string,
            "code": int,
            "result": string  // [success, failure]
        }
    }
    ```
### 获取定位结果
- 请求获取定位结果：

    ```javascript
    {
        "title":"request_get_locating_result",
        "content": {
            "id": string,
            "timestamp": long  // 标识命令发起的时戳，单位毫秒，数据类型为long
        }
    }
    ```

- 回复获取定位结果：  

    ```javascript
    {
        "title": "response_get_locating_result",
        "content": {
            "id": string,
            "timestamp": long,  // 同步命令与请求命令的时戳保持一致
            "data": string,
            "code": int,
            "result": string  // [success, failure]
        }
    }
    ```
### 获取机器人实时位置
- 请求获取机器人实时位置：
    ```javascript
    {
        "title":"request_get_position",
        "content": {
            "id": string,
            "timestamp": long  // 标识命令发起的时戳，单位毫秒，数据类型为long
        }
    }
    ```

- 回复获取机器人实时位置：  

    ```javascript
    {
        "title": "response_get_position",
        "content": {
            "id": string,
            "timestamp": long,  // 同步命令与请求命令的时戳保持一致
            "data": {
                "x": double,
                "y": double,
                "yaw": double
                }
            }
            "msg": string,
            "code": int,
            "result": string  // [success, failure]
        }
    }
    ```

---

## **导航(navigating)**

### 开始导航
- 请求开始导航：

    ```javascript
    {
        "title":"request_start_navigating",
        "content": {
            "id": string,
            "timestamp": long  // 标识命令发起的时戳，单位毫秒，数据类型为long
            "data": {
                "map_name": string, //地图名称
                "frame_id": string,
                "mode": int, // 0：有轨，1：无轨
                "path_name": string, //有轨导航路径名称，当无轨导航时为空
                "goal": [
                    {"goal_name": string, //目标点名字
                    "orientation": {
                        "roll": float,
                        "pitch": float,
                        "yaw": float
                    },
					{
                    "position": {
                        "x": float,
                        "y": float,
                        "z": float
                    }},
					{"goal_name": string, //目标点名字
                    "orientation": {
                        "roll": float,
                        "pitch": float,
                        "yaw": float
                    },
                    "position": {
                        "x": float,
                        "y": float,
                        "z": float
                    }}
					...
					]
                }
            }
        }
    }
    ```
        
- 回复开始导航：  

    ```javascript
    {
        "title": "response_start_navigating",
        "content": {
            "id": string,
            "timestamp": long,  // 同步命令与请求命令的时戳保持一致
            "msg": string,
            "code": int,
            "result": string  // [success, failure]
        }
    }
    ```
### 暂停导航
- 请求暂停导航：
    ```javascript
    {
        "title":"request_pause_navigating",
        "content": {
            "id": string,
            "timestamp": long  // 标识命令发起的时戳，单位毫秒，数据类型为long
        }
    }
    ```

- 回复暂停导航：  

    ```javascript
    {
        "title": "response_pause_navigating",
        "content": {
            "id": string,
            "timestamp": long,  // 同步命令与请求命令的时戳保持一致
            "msg": string,
            "code": int,
            "result": string  // [success, failure]
        }
    }
    ```
### 恢复导航
- 请求恢复导航：
    ```javascript
    {
        "title":"request_resume_navigating",
        "content": {
            "id": string,
            "timestamp": long  // 标识命令发起的时戳，单位毫秒，数据类型为long
        }
    }
    ```

- 回复恢复导航：  

    ```javascript
    {
        "title": "response_resume_navigating",
        "content": {
            "id": string,
            "timestamp": long,  // 同步命令与请求命令的时戳保持一致
            "msg": string,
            "code": int,
            "result": string  // [success, failure]
        }
    }
    ```
### 结束导航
- 请求结束导航
    ```javascript
    {
        "title":"request_stop_navigating",
        "content": {
            "id": string,
            "timestamp": long  // 标识命令发起的时戳，单位毫秒，数据类型为long
        }
    }
    ```

- 回复结束导航：  

    ```javascript
    {
        "title": "response_stop_navigating",
        "content": {
            "id": string,
            "timestamp": long,  // 同步命令与请求命令的时戳保持一致
            "msg": string, 
            "code": int,
            "result": string  // [success, failure]
        }
    }
    ```

### 获取导航任务状态
- 请求获取导航任务状态：
    ```javascript
    {
        "title":"request_get_navigating_status",
        "content": {
            "id": string,
            "timestamp": long  // 标识命令发起的时戳，单位毫秒，数据类型为long
        }
    }
    ```

- 回复获取导航任务状态：  

    ```javascript
    {
        "title": "response_get_navigating_status",
        "content": {
            "id": string,
            "timestamp": long,  // 同步命令与请求命令的时戳保持一致
            "msg": string,
            "code": int,
            "result": string  // [success, failure]
        }
    }
    ```
### 导航状态主动推送
- 主动推送导航状态()：

    ```javascript
    {
        "title":"notify_nav_status",
        "content": {
            "id": string,
            "timestamp": long,  // 标识命令发起的时戳，单位毫秒，数据类型为long
            "code": int, // 状态码
            "msg": string, // 状态码对应的字符
            "data": string // 该状态可能推送的一些相关数据
        }
    }
    ```
### 设置速度
- 请求设置速度：

    ```javascript
    {
        "title":"request_set_speed",
        "content": {
            "id": string,
            "timestamp": long,  // 标识命令发起的时戳，单位毫秒，数据类型为long 
            "mode":int, // 0：设置速度大小(m/s)  1：设置速度档位level(低/中/高)
            "data": {
                "level":int // 0：低，1: 中，  2: 高， 255: 当mode为0时
                "angular": {
                    "x": float,
                    "y": float,
                    "z": float
                }
                "linear": {
                    "x": float,
                    "y": float,
                    "z": float
                }
            }
        }
    }
    ```

- 回复设置速度：

    ```javascript
    {
        "title": "response_set_speed",
        "content": {
            "id": string,
            "timestamp": long,  // 同步命令与请求命令的时戳保持一致
            "msg": string,
            "code":int,
            "result": string  // [success, failure]
        }
    }
    ```
### 查看当前速度
- 请求查看当前速度：

    ```javascript
    {
        "title":"request_get_speed",
        "content": {
            "id": string,
            "timestamp": long  // 标识命令发起的时戳，单位毫秒，数据类型为long
            "mode":int, // 0：查看速度大小(m/s) 1：查看速度档位level(低/中/高)
        }
    }
    ```
    
- 回复查看当前速度：  

    ```javascript
    {
        "title": "response_get_speed",
        "content": {
            "id": string,
            "timestamp": long,  // 同步命令与请求命令的时戳保持一致
            "data": {
                "mode":int, // 0：回复速度大小(m/s) 1：回复速度档位level(低/中/高)
                "level":int // 0：低，1: 中，2: 高， 255: 当 mode 为0时
                "angular": {
                    "yaw": float,
                    "roll": float,
                    "pitch": float
                }
                "linear": {
                    "x": float,
                    "y": float,
                    "z": float
                }
            }
            "msg": string,
            "code": int,
            "result": string  // [success, failure]
        }
    }
    ```
---

### 导航行为策略配置

#### 设置安全距离
- 请求设置安全距离：
    ```javascript
    {
        "title":"request_set_safe_distance",
        "content": {
            "id": string,
            "timestamp": long,  // 标识命令发起的时戳，单位毫秒，数据类型为long
            "safe_distance": float,
        }
    }
    ```

- 回复设置安全距离：  

    ```javascript
    {
        "title": "response_set_safe_distance",
        "content": {
            "id": string,
            "timestamp": long,  // 同步命令与请求命令的时戳保持一致
            "msg": string,
            "code": int,
            "result": string  // [success, failure]
        }
    }
    ```
#### 获取安全距离
- 请求获取安全距离：
    ```javascript
    {
        "title":"request_get_safe_distance",
        "content": {
            "id": string,
            "timestamp": long  // 标识命令发起的时戳，单位毫秒，数据类型为long
        }
    }
    ```

- 回复获取安全距离：  

    ```javascript
    {
        "title": "response_get_safe_distance",
        "content": {
            "id": string,
            "timestamp": long,  // 同步命令与请求命令的时戳保持一致
            "safe_distance": float,
            "msg": string,
            "code": int,
            "result": string  // [success, failure]
        }
    }
    ```

#### 设置反应距离
- 请求设置反应距离：
    ```javascript
    {
        "title":"request_set_reaction_distance",
        "content": {
            "id": string,
            "timestamp": long,  // 标识命令发起的时戳，单位毫秒，数据类型为long
            "reaction_distance": float,
        }
    }
    ```

- 回复设置反应距离：  

    ```javascript
    {
        "title": "response_set_reaction_distance",
        "content": {
            "id": string,
            "timestamp": long,  // 同步命令与请求命令的时戳保持一致
            "msg": string,
            "code": int,
            "result": string  // [success, failure]
        }
    }
    ```
#### 获取反应距离
- 请求获取反应距离：
    ```javascript
    {
        "title":"request_get_reaction_distance",
        "content": {
            "id": string,
            "timestamp": long  // 标识命令发起的时戳，单位毫秒，数据类型为long
        }
    }
    ```

- 回复获取反应距离：  

    ```javascript
    {
        "title": "response_get_reaction_distance",
        "content": {
            "id": string,
            "timestamp": long,  // 同步命令与请求命令的时戳保持一致
            "reaction_distance": float,
            "msg": string,
            "code": int,
            "result": string  // [success, failure]
        }
    }
    ```
####  停障绕障开关命令
- 请求控制绕障开关：
    ```javascript
    {
        "title":"request_switch_avoid_obstacle",
        "content": {
            "id": string,
            "timestamp": long,  // 标识命令发起的时戳，单位毫秒，数据类型为long
            "switch": int //[0: 关, 1: 开]
        }
    }
    ```

- 回复控制绕障开关：  

    ```javascript
    {
        "title": "response_switch_avoid_obstacle",
        "content": {
            "id": string,
            "timestamp": long,  // 同步命令与请求命令的时戳保持一致
            "msg": string,
            "code": int,
            "result": string  // [success, failure]
        }
    }
    ```
#### 获取停障绕障开关状态
- 请求获取绕障开关状态：
    ```javascript
    {
        "title":"request_get_avoid_obstacle_status",
        "content": {
            "id": string,
            "timestamp": long,  // 标识命令发起的时戳，单位毫秒，数据类型为long
        }
    }
    ```

- 回复获取绕障开关状态：  

    ```javascript
    {
        "title": "response_get_avoid_obstacle_status",
        "content": {
            "id": string,
            "timestamp": long,  // 同步命令与请求命令的时戳保持一致
            "switch": int， //[0: 关, 1: 开]
            "msg": string,
            "code": int,
            "result": string  // [success, failure]
        }
    }
####  设置避障半径
- 请求设置避障半径：
    ```javascript
    {
        "title":"request_set_avoid_obstacle_radius",
        "content": {
            "id": string,
            "timestamp": long,  // 标识命令发起的时戳，单位毫秒，数据类型为long
            "avoid_obstacle_radius": float,
        }
    }
    ```

- 回复设置避障半径：  

    ```javascript
    {
        "title": "response_set_avoid_obstacle_radius",
        "content": {
            "id": string,
            "timestamp": long,  // 同步命令与请求命令的时戳保持一致
            "msg": string,
            "code": int,
            "result": string  // [success, failure]
        }
    }
    ```
#### 获取避障半径
- 请求获取避障半径：
    ```javascript
    {
        "title":"request_get_avoid_obstacle_radius",
        "content": {
            "id": string,
            "timestamp": long  // 标识命令发起的时戳，单位毫秒，数据类型为long
        }
    }
    ```

- 回复获取避障半径：  

    ```javascript
    {
        "title": "response_get_avoid_obstacle_radius",
        "content": {
            "id": string,
            "timestamp": long,  // 同步命令与请求命令的时戳保持一致
            "avoid_obstacle_radius": float,
            "msg": string,
            "code": int,
            "result": string  // [success, failure]
        }
    }
    ```
####  允许后退开关命令
- 请求允许后退开关：
    ```javascript
    {
        "title":"request_switch_backward",
        "content": {
            "id": string,
            "timestamp": long  // 标识命令发起的时戳，单位毫秒，数据类型为long
            "switch": int， //[0: 关, 1: 开]
        }
    }
    ```

- 回复允许后退开关：  

    ```javascript
    {
        "title": "response_switch_backward",
        "content": {
            "id": string,
            "timestamp": long,  // 同步命令与请求命令的时戳保持一致
            "msg": string,
            "code": int,
            "result": string  // [success, failure]
        }
    }
    ```
#### 获取允许后退开关状态
- 请求获取允许后退开关状态：
    ```javascript
    {
        "title":"request_get_backward_status",
        "content": {
            "id": string,
            "timestamp": long,  // 标识命令发起的时戳，单位毫秒，数据类型为long
        }
    }
    ```

- 回复允许控制后退开关状态：  

    ```javascript
    {
        "title": "response_get_backward_status",
        "content": {
            "id": string,
            "timestamp": long,  // 同步命令与请求命令的时戳保持一致
            "switch": int， //[0: 关, 1: 开]
            "msg": string,
            "code": int,
            "result": string  // [success, failure]
        }
    }
####  不同传感器数据在避障行为响应所占权重可配置
todo
####  智能识别避障
todo

## **传感器数据输出** [ubt -> 供应商]


超声波、里程计、IMU、GPS等小数据量传感器数据通过处理后，分别通过UDP发送序列化后的字符串数据。
摄像头和激光雷达数据直接通过访问ip获取。数据类型参考ROS sensor_msgs定义。

通信协议：UDP 

### 超声波(ultrasound)
- 发送超声波数据（通信协议：udp， 端口号：8000）

    ```javascript
    {
        "title": "notify_ultrasound_data",
        "content": {
            "id": string,
            "timestamp": long,  // 同步命令与请求命令的时戳保持一致
            "ultrasound_num": int, //超声波数量
            "ultrasound_value": [float,float,float,....]
    }
    ```
### 里程计(odometry)
- 发送里程计数据 （通信协议：udp， 端口号：8001）

    ```javascript
    {
        "title": "notify_odom_data",
        "content": {
            "id": string,
            "timestamp": long,  // 同步命令与请求命令的时戳保持一致
            "frame_id": string,
            "pose": {
                "orientation": {
                    "w": 1,
                    "x": 0,
                    "y": 0,
                    "z": 0
                },
                "position": {
                    "x": 0,
                    "y": 0,
                    "z": 0
                }
            },
            "twist": {
                "angular": {
                    "x": 0,
                    "y": 0,
                    "z": 0
                },
                "linear": {
                    "x": 0,
                    "y": 0,
                    "z": 0
                }
            }
    }
    ```

### IMU
- 发送IMU数据 （通信协议：udp， 端口号：8002）

    ```javascript
    {
        "title": "notify_imu_data",
        "content": {
            "id": string,
            "timestamp": long,  // 同步命令与请求命令的时戳保持一致
            "frame_id": string,
            "orientation": {
                "x": float,
                "y": float,
                "z": float,
                "w": float
            }, //  四元数
            "linear_acceleration": {
                "x": float,
                "y": float,
                "z": float
            }, // x,y,z 方向 线速度
            "angular_velocity": {
                "x": float,
                "y": float,
                "z": float
            } // x,y,z 方向 角速度
    }
    ```
### GPS
- 发送GPS数据 （通信协议：udp， 端口号：8003）

    ```javascript
    {
        "title": "notify_gps_data",
        "content": {
            "id": string,
            "timestamp": long,  // 同步命令与请求命令的时戳保持一致
            "frame_id:": string,
            "longitude": string,  // 经度
            "latitude": string,  // 纬度
            "altitude": string  // 高度
            "status": int    // -1: 没有gps信号(Unable to fix position),  0: 非rtk单点解(Normal fix)
                            // 1: rtk浮点解(Fixed with some sort of SBAS (e.g. WAAS)), 2: rtk固定解(Fixed with DGPS )
            "position_covariance":[float,flaot,float,
                                  float,float,flaot,
                                  float,float,float]  //位置协方差
            "position_covariance_type": int  // 0 : COVARIANCE_TYPE_UNKNOWN   1: COVARIANCE_TYPE_APPROXIMATED
                                             // 2 : COVARIANCE_TYPE_DIAGONAL_KNOWN 3: COVARIANCE_TYPE_KNOWN

    }
    ```


### 摄像头(Camera)

- 直接访问获取


### 激光雷达(Lidar)

- 直接访问获取


......

---


## **底盘控制数据（线速度、角速度）输出**   [供应商 -> ubt]


通信协议: TCP

指定端口号：9000

发送序列化后的json字符串，消息类型参考ros twist消息。

```javascript
{
    "title": "notify_control_data",
    "content": {
        "id": string,
        "timestamp": long,  // 同步命令与请求命令的时戳保持一致
        "data": {
            "angular": {
                "x": float,
                "y": float,
                "z": float
            },
            "linear": {
                "x": float,
                "y": float,
                "z": float
            }
        }
}
```
---

## **附录**
### 状态码/错误码

```javascript
    0000 idel //无导航任务

    // 1*** 初始化相关状态码
    1000  relocate finish //定位成功
    1001  relocating    //定位中
    1002  relocate failed //定位失败

    // 2*** 建图相关状态码
    2000 mapping succeed  //建图成功
    2001 mapping failed  //建图失败
    2002 mapping running  //建图中

        
    // 3*** 导航相关状态码
    3000  reached //导航成功 
    3001  planning //规划路径中 
    3002  path is not safe //路径不安全
    3003  path is invalid //路径无效
    3001  path planning failed //路径规划失败
    3004  obstacle in front //前面有障碍物
    3005  avoiding obstacle //避障中
    3006  following path  //跟线中 
    3007  follow path finished //跟线结束
    3008  navigating //导航中
    3009  goal point unreachable //目标点不可达
    3010  goal unreached //到达目标
    3011  localization lost //定位丢失
    3012  localization lost for crowd lookers //由于围观定位丢失
    3013  localization lost for open area //由于空阔区域定位丢失
    3014  localization lost for changed enviroment //环境变化定位丢失
    
    // 4***转圈
    4000  rotating //正在转圈 
    4001  cannot rotate //不能转圈
    4002  roate finished //转圈结束
    4003  rotate failed //转圈失败
    
    // 5***传感器触发/异常
    //500*激光雷达
    5001  laser param not valid //激光雷达不匹配
    5002  ... 激光雷达数据收不到
  
    //501*摄像头

    //502*超声波
    5020  ultrasound check //超声

    //503*IMU


    //504*里程计

    //505*GPS

    //506*rgbd
    5060 rgbd check //rgbd

    //507*rfid
    5070  rfid check //rfid

    ...
    // 6***系统问题
    6001 usb key not valid
        
    //7 ** 其它
    todo
    ...
```
